<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Commit CSV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .terminal-window {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .terminal-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #30363d;
        }

        .terminal-dots {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red { background: #ff5f56; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #27c93f; }

        .terminal-title {
            color: #8b949e;
            font-size: 13px;
        }

        .hidden {
            display: none !important;
        }

        h1 {
            color: #58a6ff;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #8b949e;
            font-size: 14px;
            margin-bottom: 25px;
        }

        .prompt {
            color: #3fb950;
            margin-right: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #8b949e;
            font-size: 13px;
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="password"],
        textarea {
            width: 100%;
            padding: 10px 12px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.2s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #58a6ff;
        }

        input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            width: 100%;
            padding: 40px 20px;
            background: #0d1117;
            border: 2px dashed #30363d;
            border-radius: 6px;
            color: #8b949e;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-btn:hover {
            border-color: #58a6ff;
            background: #161b22;
        }

        .file-upload-btn.has-file {
            border-color: #3fb950;
            border-style: solid;
            background: #0f1c12;
        }

        .file-info {
            margin-top: 10px;
            padding: 12px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            font-size: 13px;
            color: #8b949e;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            color: #3fb950;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: background 0.2s;
        }

        button:hover:not(:disabled) {
            background: #2ea043;
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            background: #6e7681 !important;
        }

        button.primary-btn:not(:disabled) {
            background: #238636;
            color: white;
            box-shadow: 0 0 0 1px rgba(35, 134, 54, 0.4);
        }

        button.primary-btn:not(:disabled):hover {
            background: #2ea043;
            box-shadow: 0 0 0 2px rgba(46, 160, 67, 0.6);
        }

        button.secondary {
            background: #21262d;
            border: 1px solid #30363d;
            color: #c9d1d9;
        }

        button.secondary:hover:not(:disabled) {
            background: #30363d;
        }

        .status {
            margin-top: 15px;
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 13px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status.success {
            background: #0f1c12;
            color: #3fb950;
            border: 1px solid #2f563f;
            display: block;
        }

        .status.error {
            background: #2b1a1a;
            color: #f85149;
            border: 1px solid #6e3630;
            display: block;
        }

        .status.info {
            background: #161b26;
            color: #58a6ff;
            border: 1px solid #2f3a4f;
            display: block;
        }

        .status a {
            color: inherit;
            font-weight: bold;
            text-decoration: underline;
        }

        .helper-text {
            font-size: 12px;
            color: #6e7681;
            margin-top: 6px;
        }

        .helper-text a {
            color: #58a6ff;
            text-decoration: none;
        }

        .helper-text a:hover {
            text-decoration: underline;
        }

        .config-display {
            background: #0d1117;
            border: 1px solid #30363d;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .config-line {
            color: #8b949e;
            margin-bottom: 4px;
        }

        .config-value {
            color: #58a6ff;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .commit-section {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin-top: 20px;
        }

        .commit-header {
            color: #c9d1d9;
            font-size: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        textarea.commit-message {
            min-height: 80px;
            resize: vertical;
            margin-bottom: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            color: #c9d1d9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="terminal-window">
            <div class="terminal-header">
                <div class="terminal-dots">
                    <div class="dot red"></div>
                    <div class="dot yellow"></div>
                    <div class="dot green"></div>
                </div>
                <div class="terminal-title">git-auth</div>
            </div>

            <h1><span class="prompt">$</span> git config --global user.token</h1>
            <p class="subtitle">Authenticate with GitHub to begin</p>

            <form id="loginForm">
                <div class="form-group">
                    <label>GitHub Personal Access Token</label>
                    <input type="password" id="token" required placeholder="ghp_xxxxxxxxxxxx">
                    <div class="helper-text">
                        <a href="https://github.com/settings/tokens/new?scopes=repo&description=CSV%20Commit%20Tool" target="_blank">‚Üí Generate token</a> with 'repo' scope
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="rememberMe" checked>
                    <label for="rememberMe">Remember me locally</label>
                </div>

                <button type="submit">Authenticate</button>
            </form>

            <div class="status" id="loginStatus"></div>
        </div>

        <!-- Main Screen -->
        <div id="mainScreen" class="hidden">
            <!-- Repository Config -->
            <div class="terminal-window">
                <div class="terminal-header">
                    <div class="terminal-dots">
                        <div class="dot red"></div>
                        <div class="dot yellow"></div>
                        <div class="dot green"></div>
                    </div>
                    <div class="terminal-title">git-remote</div>
                </div>

                <h1><span class="prompt">$</span> git remote -v</h1>
                <p class="subtitle">Repository configuration</p>

                <div id="configDisplay" class="hidden">
                    <div class="config-display">
                        <div class="config-line">origin: <span class="config-value" id="displayRepo"></span></div>
                        <div class="config-line">user: <span class="config-value" id="displayUser"></span></div>
                    </div>
                    <div class="actions">
                        <button class="secondary" id="editConfigBtn" style="width: auto;">Edit Config</button>
                        <button class="secondary" id="logoutBtn" style="width: auto;">Logout</button>
                    </div>
                </div>

                <form id="configForm">
                    <div class="form-group">
                        <label>Repository Owner</label>
                        <input type="text" id="owner" required placeholder="username or organization">
                    </div>

                    <div class="form-group">
                        <label>Repository Name</label>
                        <input type="text" id="repo" required placeholder="my-repository">
                    </div>

                    <div class="form-group">
                        <label>CSV File Path</label>
                        <input type="text" id="filePath" required placeholder="data.csv or path/to/data.csv">
                        <div class="helper-text">Path to your CSV file in the repository</div>
                    </div>

                    <button type="submit" id="saveConfigBtn">Save Configuration</button>
                </form>

                <div class="status" id="configStatus"></div>
            </div>

            <!-- Commit Section -->
            <div id="commitSection" class="terminal-window hidden">
                <div class="terminal-header">
                    <div class="terminal-dots">
                        <div class="dot red"></div>
                        <div class="dot yellow"></div>
                        <div class="dot green"></div>
                    </div>
                    <div class="terminal-title">git-commit</div>
                </div>

                <h1><span class="prompt">$</span> git add . && git commit</h1>
                <p class="subtitle">Upload and commit your CSV file</p>

                <div class="form-group">
                    <label>Select CSV File</label>
                    <label for="csvFile" class="file-upload-btn" id="uploadBtn">
                        <div style="font-size: 32px; margin-bottom: 10px;">üìÑ</div>
                        <div>Click to select or drag & drop your CSV file</div>
                        <div style="font-size: 12px; margin-top: 8px; color: #6e7681;">Accepted: .csv files</div>
                    </label>
                    <input type="file" id="csvFile" accept=".csv" required>
                    <div class="file-info" id="fileInfo"></div>
                </div>

                <div class="commit-section">
                    <div class="commit-header">
                        ‚úçÔ∏è Commit Message
                    </div>
                    <textarea
                        class="commit-message"
                        id="commitMessage"
                        placeholder="Update data.csv&#10;&#10;Add detailed description here (optional)..."
                        required
                    ></textarea>
                    <div style="display: flex; gap: 10px;">
                        <button id="pushBtn" style="flex: 1;" class="primary-btn">Push to Staging</button>
                        <button id="createPRBtn" style="flex: 1;" class="primary-btn" disabled>Create Pull Request</button>
                    </div>
                </div>

                <div class="status" id="commitStatus"></div>
            </div>
        </div>
    </div>

    <script>
        // State
        const state = {
            token: null,
            user: null,
            owner: null,
            repo: null,
            branch: 'main',
            filePath: null,
            csvFile: null,
            configSaved: false,
            commitMode: 'pr', // Default to PR mode since direct commit is hidden
            pushedToStaging: false, // Track if push to staging is complete
            lastCommitMessage: null // Store commit message from push
        };

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const mainScreen = document.getElementById('mainScreen');
        const configForm = document.getElementById('configForm');
        const configDisplay = document.getElementById('configDisplay');
        const commitSection = document.getElementById('commitSection');
        const csvFileInput = document.getElementById('csvFile');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInfo = document.getElementById('fileInfo');

        // Initialize
        init();

        function init() {
            const savedToken = localStorage.getItem('githubToken');
            const savedUser = localStorage.getItem('githubUser');
            
            if (savedToken && savedUser) {
                state.token = savedToken;
                state.user = savedUser;
                showMainScreen();
            }

            setupEventListeners();
        }

        function setupEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Config
            document.getElementById('configForm').addEventListener('submit', handleConfigSave);
            document.getElementById('editConfigBtn').addEventListener('click', showConfigForm);

            // File upload
            csvFileInput.addEventListener('change', handleFileSelect);
            uploadBtn.addEventListener('click', () => csvFileInput.click());
            
            // Drag and drop
            uploadBtn.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadBtn.style.borderColor = '#3fb950';
            });
            
            uploadBtn.addEventListener('dragleave', () => {
                uploadBtn.style.borderColor = '#30363d';
            });
            
            uploadBtn.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadBtn.style.borderColor = '#30363d';
                if (e.dataTransfer.files.length > 0) {
                    csvFileInput.files = e.dataTransfer.files;
                    handleFileSelect({ target: csvFileInput });
                }
            });

            // Commit
            document.getElementById('commitMessage').addEventListener('input', updateButtons);
            document.getElementById('pushBtn').addEventListener('click', handlePushToStaging);
            document.getElementById('createPRBtn').addEventListener('click', handleCreatePR);
        }

        async function handleLogin(e) {
            e.preventDefault();
            const token = document.getElementById('token').value.trim();
            const rememberMe = document.getElementById('rememberMe').checked;

            showStatus('loginStatus', 'Authenticating with GitHub...', 'info');

            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Invalid token or authentication failed');
                }

                const userData = await response.json();
                state.token = token;
                state.user = userData.login;

                if (rememberMe) {
                    localStorage.setItem('githubToken', token);
                    localStorage.setItem('githubUser', userData.login);
                }

                showStatus('loginStatus', '‚úì Authentication successful', 'success');
                setTimeout(showMainScreen, 800);

            } catch (error) {
                showStatus('loginStatus', `‚úó ${error.message}`, 'error');
            }
        }

        function handleLogout() {
            if (confirm('Logout and clear saved credentials?')) {
                localStorage.clear();
                location.reload();
            }
        }

        function showMainScreen() {
            loginScreen.classList.add('hidden');
            mainScreen.classList.remove('hidden');
            document.getElementById('displayUser').textContent = `@${state.user}`;
        }

        function handleConfigSave(e) {
            e.preventDefault();

            state.owner = document.getElementById('owner').value.trim();
            state.repo = document.getElementById('repo').value.trim();
            state.filePath = document.getElementById('filePath').value.trim();
            state.branch = 'main'; // Fixed to main
            state.configSaved = true;

            // Update display
            document.getElementById('displayRepo').textContent = `${state.owner}/${state.repo}/${state.filePath}`;

            // Show config display, hide form
            configForm.classList.add('hidden');
            configDisplay.classList.remove('hidden');
            commitSection.classList.remove('hidden');

            showStatus('configStatus', '‚úì Configuration saved', 'success');
            setTimeout(() => {
                document.getElementById('configStatus').style.display = 'none';
            }, 2000);

            // Update button states
            updateButtons();
        }

        function showConfigForm() {
            configForm.classList.remove('hidden');
            configDisplay.classList.add('hidden');

            // Pre-fill form
            if (state.owner) document.getElementById('owner').value = state.owner;
            if (state.repo) document.getElementById('repo').value = state.repo;
            if (state.filePath) document.getElementById('filePath').value = state.filePath;
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            
            if (!file) return;

            if (!file.name.endsWith('.csv')) {
                alert('Please select a CSV file');
                csvFileInput.value = '';
                return;
            }

            state.csvFile = file;
            
            const sizeKB = (file.size / 1024).toFixed(2);
            fileInfo.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span class="file-name">${file.name}</span>
                        <span style="margin-left: 10px;">(${sizeKB} KB)</span>
                    </div>
                    <button class="secondary" onclick="clearFile()" style="width: auto; padding: 6px 12px;">Clear</button>
                </div>
            `;
            fileInfo.classList.add('show');
            uploadBtn.classList.add('has-file');

            updateButtons();
        }

        function clearFile() {
            state.csvFile = null;
            csvFileInput.value = '';
            fileInfo.classList.remove('show');
            uploadBtn.classList.remove('has-file');
            state.pushedToStaging = false;
            updateButtons();
        }

        function updateButtons() {
            const message = document.getElementById('commitMessage').value.trim();
            const pushButton = document.getElementById('pushBtn');
            const prButton = document.getElementById('createPRBtn');

            if (pushButton) {
                // Push button enabled when file + message + config saved
                pushButton.disabled = !state.csvFile || !message || !state.configSaved;
                console.log('Push button:', {
                    hasFile: !!state.csvFile,
                    hasMessage: !!message,
                    configSaved: state.configSaved,
                    disabled: pushButton.disabled
                });
            }

            if (prButton) {
                // PR button enabled only after successful push to staging
                prButton.disabled = !state.pushedToStaging;
            }
        }

        async function handlePushToStaging() {
            if (!state.csvFile) {
                showStatus('commitStatus', '‚úó Please select a CSV file', 'error');
                return;
            }

            const message = document.getElementById('commitMessage').value.trim();
            if (!message) {
                showStatus('commitStatus', '‚úó Please enter a commit message', 'error');
                return;
            }

            const pushButton = document.getElementById('pushBtn');
            pushButton.disabled = true;
            showStatus('commitStatus', '‚è≥ Reading file...', 'info');

            try {
                // Read file as base64
                const base64Content = await readFileAsBase64(state.csvFile);

                // Target branch is always staging
                const targetBranch = 'staging';

                // Ensure staging branch exists
                showStatus('commitStatus', '‚è≥ Ensuring staging branch exists...', 'info');
                await ensureStagingBranchExists();

                showStatus('commitStatus', `‚è≥ Checking if file exists on ${targetBranch}...`, 'info');

                // Check if file exists (to get SHA for update)
                let sha = null;
                try {
                    const checkResponse = await fetch(
                        `https://api.github.com/repos/${state.owner}/${state.repo}/contents/${state.filePath}?ref=${targetBranch}`,
                        {
                            headers: {
                                'Authorization': `token ${state.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );

                    if (checkResponse.ok) {
                        const existingFile = await checkResponse.json();
                        sha = existingFile.sha;
                        showStatus('commitStatus', '‚è≥ Updating existing file...', 'info');
                    } else {
                        showStatus('commitStatus', '‚è≥ Creating new file...', 'info');
                    }
                } catch (error) {
                    // File doesn't exist, will create new
                }

                // Prepare commit data
                const commitData = {
                    message: message,
                    content: base64Content,
                    branch: targetBranch
                };

                if (sha) {
                    commitData.sha = sha;
                }

                // Commit to GitHub
                showStatus('commitStatus', `‚è≥ Committing to ${targetBranch} branch...`, 'info');
                const response = await fetch(
                    `https://api.github.com/repos/${state.owner}/${state.repo}/contents/${state.filePath}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${state.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(commitData)
                    }
                );

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Commit failed: ${response.status}`);
                }

                const result = await response.json();

                // Mark push as complete
                state.pushedToStaging = true;
                state.lastCommitMessage = message;

                // Show push success
                showStatus('commitStatus', '‚úì Successfully pushed to staging branch! You can now create a pull request.', 'success');

                // Enable PR button
                updateButtons();

            } catch (error) {
                showStatus('commitStatus', `‚úó Error: ${error.message}`, 'error');
                console.error('Push error:', error);
            } finally {
                const pushButton = document.getElementById('pushBtn');
                if (pushButton) pushButton.disabled = false;
            }
        }

        async function handleCreatePR() {
            if (!state.pushedToStaging) {
                showStatus('commitStatus', '‚úó Please push to staging first', 'error');
                return;
            }

            const message = state.lastCommitMessage || document.getElementById('commitMessage').value.trim();

            const prButton = document.getElementById('createPRBtn');
            prButton.disabled = true;
            showStatus('commitStatus', '‚è≥ Creating pull request...', 'info');

            try {
                const prResult = await createPullRequest(message);

                showStatus(
                    'commitStatus',
                    `‚úì Pull request created! <a href="${prResult.html_url}" target="_blank">View PR #${prResult.number} ‚Üí</a>`,
                    'success'
                );

                // Reset form
                clearFile();
                document.getElementById('commitMessage').value = '';
                state.pushedToStaging = false;
                state.lastCommitMessage = null;
                updateButtons();

            } catch (error) {
                showStatus('commitStatus', `‚úó Error: ${error.message}`, 'error');
                console.error('PR creation error:', error);
            } finally {
                const prButton = document.getElementById('createPRBtn');
                if (prButton) prButton.disabled = false;
            }
        }

        async function ensureStagingBranchExists() {
            try {
                // Check if staging branch exists
                const checkBranchResponse = await fetch(
                    `https://api.github.com/repos/${state.owner}/${state.repo}/git/refs/heads/staging`,
                    {
                        headers: {
                            'Authorization': `token ${state.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );

                if (checkBranchResponse.ok) {
                    // Staging branch exists
                    return;
                }

                // Get the main branch SHA
                const mainBranchResponse = await fetch(
                    `https://api.github.com/repos/${state.owner}/${state.repo}/git/refs/heads/main`,
                    {
                        headers: {
                            'Authorization': `token ${state.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );

                if (!mainBranchResponse.ok) {
                    throw new Error('Could not find main branch');
                }

                const mainBranchData = await mainBranchResponse.json();
                const mainSha = mainBranchData.object.sha;

                // Create staging branch from main
                const createBranchResponse = await fetch(
                    `https://api.github.com/repos/${state.owner}/${state.repo}/git/refs`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${state.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ref: 'refs/heads/staging',
                            sha: mainSha
                        })
                    }
                );

                if (!createBranchResponse.ok) {
                    const errorData = await createBranchResponse.json();
                    throw new Error(errorData.message || 'Failed to create staging branch');
                }

            } catch (error) {
                throw new Error(`Failed to ensure staging branch exists: ${error.message}`);
            }
        }

        async function createPullRequest(commitMessage) {
            try {
                // Check if a PR already exists
                const existingPRResponse = await fetch(
                    `https://api.github.com/repos/${state.owner}/${state.repo}/pulls?head=${state.owner}:staging&base=main&state=open`,
                    {
                        headers: {
                            'Authorization': `token ${state.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );

                if (existingPRResponse.ok) {
                    const existingPRs = await existingPRResponse.json();
                    if (existingPRs.length > 0) {
                        // Return existing PR
                        return existingPRs[0];
                    }
                }

                // Create new PR
                const prData = {
                    title: commitMessage.split('\n')[0], // Use first line as title
                    head: 'staging',
                    base: 'main',
                    body: commitMessage
                };

                const response = await fetch(
                    `https://api.github.com/repos/${state.owner}/${state.repo}/pulls`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${state.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(prData)
                    }
                );

                if (!response.ok) {
                    const errorData = await response.json();
                    // Provide more detailed error message
                    let errorMsg = errorData.message || `PR creation failed: ${response.status}`;
                    if (errorData.errors) {
                        errorMsg += ` - ${JSON.stringify(errorData.errors)}`;
                    }
                    throw new Error(errorMsg);
                }

                return await response.json();

            } catch (error) {
                throw new Error(`Failed to create pull request: ${error.message}`);
            }
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.className = `status ${type}`;
            element.innerHTML = message;
        }

        // Global function for inline handler
        window.clearFile = clearFile;
    </script>
</body>
</html>